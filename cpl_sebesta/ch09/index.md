# 9. Υποπρογράμματα

[ΑΡΧΕΣ ΓΛΩΣΣΩΝ ΠΡΟΓΡΑΜΜΑΤΙΣΜΟΥ (R.W.Sebesta) - Κεφάλαιο 9](./../../resources/pl11ch9GR.pdf)

* Σχεδιασμός υποπρογραμμάτων
* Μέθοδοι μεταβίβασης παραμέτρων
* Τοπικά περιβάλλοντα αναφοράς
* Υπερφορτωμένα υποπρογράμματα
* Γενικά υποπρογράμματα
* Ψευδωνυμία
* Έμμεση κλήση υποπρογραμμάτων
* Κλειστότητες
* Συρρουτίνες

## 9.1 Εισαγωγή

Τα υποπρογράμματα αποτελούν **αφαιρέσεις διεργασιών**. Οι λεπτομέρειες μιας διεργασίας αντικαθίστανται με την κλήση ενός υποπρογράμματος. Έτσι διευκολύνεται η ανάγνωση του κώδικα, εξοικονομείται χώρος μνήμης και χρόνος κωδικοποίησης.

## 9.2 Βασικά στοιχεία υποπρογραμμάτων

### 9.2.1 Γενικά στοιχεία υποπρογραμμάτων

* Κάθε υποπρόγραμμα έχει ένα σημείο εισόδου.
* Μόνο ένα υποπρόγραμμα εκτελείται ανά πάσα στιγμή (δεν ισχύει στα ταυτόχρονα προγράμματα).
* Ο έλεγχος επιστρέφει στο πρόγραμμα που καλεί ένα υποπρόγραμμα όταν ολοκληρώνεται η κλήση του.

### 9.2.2 Βασικοί ορισμοί

Βασικά είδη υποπρογραμμάτων: διαδικασίες,  συναρτήσεις

**Κεφαλίδα υποπρογράμματος**

Η κεφαλίδα ενός υποπρογράμματος καθορίζει το είδος του, το όνομά του (αν έχει) και τη λίστα παραμέτρων του. 

**Σώμα υποπρογράμματος**

Το σώμα ενός υποπρογράμματος ορίζει τις ενέργειες που θα εκτελεί το υποπρόγραμμα.

**Ιδιαίτερες περιπτώσεις**

Στην Python οι ορισμοί των συναρτήσεων **είναι εκτελέσιμοι**. Οπότε μπορεί να γραφεί κώδικας της μορφής:

```python
x = 1
if x == 1:
    def foo():
        print("A")
else:
    def foo():
        print("B")
foo()
```

Η εκτέλεση του παραπάνω κώδικα θα εμφανίσει A

Στην Ruby αν και συνήθως οι μέθοδοι ορίζονται σε κλάσεις, ωστόσο μπορούν να οριστούν και εκτός κλάσεων οπότε θεωρούνται μέθοδοι της κλάσης Object.

Στην Lua οι συναρτήσεις είναι ανώνυμες, αλλά μπορούν να οριστούν με τέτοιο τρόπο που να τους αποδίδεται όνομα

```lua
function cube(x) return x * x * x end

```

ή (με ανώνυμη συνάρτηση)

```lua
cube = function(x) return x * x * x end

```

Το **πρωτόκολλο** ενός υποπρογράμματος περιέχει τον αριθμό των παραμέτρων, τη σειρά με την οποία παρατίθενται, τον τύπο τους και εάν πρόκειται για συνάρτηση τον τύπο επιστροφής της.

Στη C και στη C++ χρησιμοποιούνται τα **πρωτότυπα συναρτήσεων** που αποτελούν δηλώσεις συναρτήσεων πριν τον ορισμό τους. Στις περισσότερες άλλες γλώσσες δεν χρησιμοποιούνται ξεχωριστές δηλώσεις των υποπρογραμμάτων.


Παράδειγμα με prototype στη C

* [prototype1.c](./../../pl/c/prototype1.c)

Παράδειγμα με prototype σε header στη C

* [prototype2.h](./../../pl/c/prototype2.h)
* [prototype2.c](./../../pl/c/prototype2.c)

### 9.2.3 Παράμετροι

Οι παράμετροι στην κεφαλίδα του υποπρογράμματος ονομάζονται τυπικές ή επίσημες (formal) παράμετροι ή ορίσματα, ενώ οι παράμετροι στην κλήση του υποπρογράμματος ονομάζονται πραγματικές (actual) παράμετροι ή απλά παράμετροι.

**Παράμετροι θέσης και παράμετροι λέξεων κλειδιών**

Παράδειγμα στην Python με παραμέτρους λέξεων κλειδιών (keywords)

```python
def fun(x, y, z):
    print(
        f"Το πρώτο όρισμα είναι {x}, το δεύτερο όρισμα είναι {y}, το τρίτο όρισμα είναι {z}"
    )


fun(1, 2, 3) 
fun(x=1, y=2, z=3) # κλήση με keywords
fun(y=2, x=1, z=3) # κλήση με keywords
fun(1, z=3, y=2) # κλήση με απλά ορίσματα και keywords
```

θα εμφανίσει

```
Το πρώτο όρισμα είναι 1, το δεύτερο όρισμα είναι 2, το τρίτο όρισμα είναι 3
Το πρώτο όρισμα είναι 1, το δεύτερο όρισμα είναι 2, το τρίτο όρισμα είναι 3
Το πρώτο όρισμα είναι 1, το δεύτερο όρισμα είναι 2, το τρίτο όρισμα είναι 3
Το πρώτο όρισμα είναι 1, το δεύτερο όρισμα είναι 2, το τρίτο όρισμα είναι 3
```

Παράδειγμα στη C++ με named arguments

[named_args.cpp](./../../pl/cpp/named_args.cpp)


**Προκαθορισμένες (default) τιμές**

Σε γλώσσες όπως οι Python, Ruby, C++, PHP οι τυπικές παράμετροι μπορούν να έχουν προκαθορισμένες τιμές.


Παράδειγμα στην Python με προκαθορισμένες τιμές παραμέτρων

```python
def fun(x=1, y=2):
    print(x, y)


fun() # κλήση της συνάρτησης fun χωρίς ορίσματα (το x λαμβάνει την τιμή 1 και το y λαμβάνει την τιμή 2)
fun(5) # το x λαμβάνει την τιμή 5 και το y λαμβάνει την προκαθορισμένη τιμή 2)
fun(x=5) # το x λαμβάνει την τιμή 5 και το y λαμβάνει την προκαθορισμένη τιμή 2)
fun(y=10) # το x λαμβάνει την προκαθορισμένη τιμή 1 και το y λαμβάνει την τιμή 10)
fun(5, 10) # το x λαμβάνει την τιμή 5 και το y λαμβάνει την τιμή 10)
fun(5, y=10) # το x λαμβάνει την τιμή 5 και το y λαμβάνει την τιμή 10)
```

Παράδειγμα στη C++ με προκαθορισμένες τιμές παραμέτρων (οι παράμετροι με προκαθορισμένες τιμές πρέπει να εμφανίζονται τελευταίοι στη λίστα παραμέτρων της συνάρτησης)

[default_args.cpp](./../../pl/cpp/default_args.cpp)


**Μεταβλητός αριθμός παραμέτρων**

Παράδειγμα στην Python

```python
def fun(*args, **kwargs):
    print(args)
    print(kwargs)


fun(1, 2, 3, a="data1", b="data2")
```

θα εμφανίσει

```
(1, 2, 3)
{'a': 'data1', 'b': 'data2'}
```

Παράδειγμα στη C

H printf είναι ένα παράδειγμα variadic συνάρτησης. Η δήλωσή της είναι η ακόλουθη:

```c
int printf(const char* format, ...);
```

Δείτε τη σελίδα στο cppreference για τις variadic functions στη C: <https://en.cppreference.com/w/c/variadic>

[variadic_function.c](./../../pl/c/variadic_function.c)

ισοδύναμος κώδικας σε Python

```python
def sum_all(*args):
    return sum(args)

print(sum_all(10,20))
print(sum_all(10,20,30))
print(sum_all(10,20,30,40))
```

θα εμφανίσει

```
30
60
100
```

### 9.2.4 Διαδικασίες και συναρτήσεις

Μόνο κάποιες παλιότερες γλώσσες όπως η Ada, Pascal και Fortran υποστηρίζουν τις διαδικασίες. Οι διαδικασίες είναι συλλογές εντολές που ορίζουν υπολογισμούς που καθορίζονται με βάση τις παραμέτρους. Οι συναρτήσεις είναι μια αφαίρεση των μαθηματικών συναρτήσεων. Ωστόσο οι συναρτήσεις μπορούν να προκαλούν side-effects, δηλαδή να αλλάζουν τιμές παραμέτρων ή τιμές άλλων μεταβλητών που ορίζονται εκτός των συναρτήσεων.

## 9.3 Ζητήματα σχεδιασμού για υποπρογράμματα

**Υπερφορτωμένο** είναι ένα υποπρόγραμμα που έχει το ίδιο όνομα με ένα άλλο υποπρόγραμμα στο ίδιο περιβάλλον αναφοράς

**Γενικό** είναι ένα υποπρόγραμμα το οποίο μπορεί να κληθεί με παραμέτρους διαφορετικών τύπων από κλήση σε κλήση.

**Κλειστότητα** είναι ένα ένθετο υποπρόγραμμα και το περιβάλλον αναφοράς του.

## 9.4 Τοπικά περιβάλλοντα αναφοράς

### 9.4.1 Τοπικές μεταβλητές

Τα υποπρογράμματα μπορούν να ορίζουν  τις δικές τους μεταβλητές, ορίζοντας με αυτό τον τρόπο τοπικά περιβάλλοντα αναφοράς.

Παράδειγμα με τοπικές μεταβλητές (στατικές και δυναμικής δέσμευσης μνήμης) στη C++

[static2.cpp](./../../pl/cpp/static2.cpp)

### 9.4.2 Ένθετα υποπρογράμματα

Η πρώτη γλώσσα που υποστήριξε την ένθεση υποπρογραμμάτων, δηλαδή τον ορισμό ενός υποπρογράμματος μέσα σε ένα άλλο υποπρόγραμμα ήταν η Algol 60. Άλλες γλώσσες προγραμματισμού που επίσης υποστηρίζουν την ένθεση υποπρογραμμάτων είναι οι Ada, Pascal, Python, JavaScript, Ruby και Lua.

Παράδειγμα ένθετης συνάρτησης στη python

```python
def outer_fun():
    a = 1
    print(f"αρχή συνάρτησης outer_fun, a={a}")
    def inner_fun(x):
        print(f"κλήση ένθετης συνάρτησης inner_fun, x={x}, a={a}")

    inner_fun(2)
    print(f"τέλος συνάρτησης outer_fun, a={a}")

outer_fun()
```

θα εμφανίσει

```
αρχή συνάρτησης outer_fun, a=1
κλήση ένθετης συνάρτησης inner_fun, x=2, a=1
τέλος συνάρτησης outer_fun, a=1
```

## 9.5 Μέθοδοι μεταβίβασης παραμέτρων

Μέθοδος μεταβίβασης παραμέτρων είναι ο τρόπος με τον οποίο οι παράμετροι μεταδίδονται προς και από τα καλούμενα υποπρογράμματα.

### 9.5.1 Μοντέλα σημασιολογίας μεταβίβασης παραμέτρων

* Λειτουργία εισόδου: η τυπική παράμετρος δέχεται δεδομένα από την πραγματική παράμετρο
* Λειτουργία εξόδου: η τυπική παράμετρος επιστρέφει δεδομένα στην πραγματική παράμετρο
* Διπλή λειτουργία: η τυπική παράμετρος δέχεται δεδομένα απο την πραγματική παράμετρο και επιστρέφει δεδομένα στην πραγματική παράμετρο

Υπάρχουν δύο εννοιολογικά μοντέλα για τον τρόπο μεταφοράς δεδομένων στις παραμέτρους
* αντιγραφή της τιμής
* μετάδοση μιας διαδρομής πρόσβασης (δείκτης ή αναφορά)

### 9.5.2 Μοντέλα υλοποίησης μεταβίβασης παραμέτρων

#### 9.5.2.1 Μεταβίβαση κατά τιμή ή κατ' αξία (pass by value)

Η τιμή της πραγματικής μεταβλητής χρησιμοποιείται για την αρχικοποίηση της αντίστοιχης τυπικής παραμέτρου (λειτουργία εισόδου).

#### 9.5.2.2 Μεταβίβαση κατά αποτέλεσμα (pass by result)

Δεν μεταβιβάζεται καμία τιμή στο υποπρόγραμμα κατά την κλήση. Η τελική τιμή της τυπικής παραμέτρου μεταδίδεται στην αντίστοιχη τοπική μεταβλητή. 


#### 9.5.2.3 Μεταβίβαση κατά τιμή και αποτέλεσμα (pass by value-result) ή με αντιγραφή

Συνδυασμός της μεταβίβασης κατά τιμή και της μεταβίβασης κατά αποτέλεσμα. Η πραγματική παράμετρος αντιγράφεται στην  τυπική όταν ξεκινά το υποπρόγραμμα και μετά αντιγράφεται ξανά πίσω όταν τερματίζεται το υποπρόγραμμα.

#### 9.5.2.4 Μεταβίβαση κατά αναφορά (pass by reference)

Δεν πραγματοποιούνται αντιγραφές τιμών από τις πραγματικές παραμέτρους προς τις τυπικές παραμέτρους και αντίστροφα, όπως στη μεταβίβαση κατά τιμή και κατά αποτέλεσμα, αλλά μεταδίδεται μια διαδρομή πρόσβασης, συνήθως απλά μια διεύθυνση στο καλούμενο υποπρόγραμμα.

#### 9.5.2.5 Μεταβίβαση κατά όνομα (pass by name)

Είναι μέθοδος μεταβίβασης διπλής λειτουργίας. Λειτουργεί με αντικατάσταση στο κείμενο του υποπρογράμματος του ονόματος του ορίσματος (παρόμοια με τις μακροεντολές της C). Δεν χρησιμοποιείται σε κάποια διαδεδομένη γλώσσα.

Δείτε σχετικά στο <https://stackoverflow.com/questions/838079/what-is-pass-by-name-and-how-does-it-work-exactly>


### 9.5.3 Υλοποίηση μεθόδων μεταβίβασης παραμέτρων

Στις περισσότερες σύγχρονες γλώσσες, η επικοινωνία μεταξύ παραμέτρων γίνεται μέσω της στοίβας χρόνου εκτέλεσης.

### 9.5.4 Μέθοδοι μεταβίβασης παραμέτρων σε γνωστές γλώσσες


**C**

Στη C όλες οι παράμετροι μεταβιβάζονται κατά τιμή. Με τη χρήση δεικτών επιτυγχάνεται η μεταβίβαση κατά αναφορά, και επιπλέον με τη χρήση του const στις τυπικές παραμέτρους η μονόδρομη μεταβίβαση κατά αναφορά.

[pass_by_value.c](./../../pl/c/pass_by_value.c)

**C++**

Στη C++ όλες οι παράμετροι μεταβιβάζονται κατά τιμή. H C++ περιέχει ένα ειδικό δείκτη, την αναφορά που χρησιμοποιείται στις τυπικές παραμέτρους έτσι ώστε να υποδηλώσει μεταβίβαση με αναφορά.

[pass_by_value.cpp](./../../pl/cpp/pass_by_value.cpp)

**Java**

Στη Java όλες οι παράμετροι μεταβιβάζονται κατά τιμή. Ωστόσο, επιτυγχάνεται προσομοίωση μεταβίβασης με αναφορά με χρήση αντικειμένων.

[Example1.java](./../../pl/java/pass_by_value/Example1.java)

**Python**

Στην Python όλες οι παράμετροι μεταβιβάζονται κατά εκχώρηση. Ωστόσο, επιτυγχάνεται προσομοίωση μεταβίβασης με αναφορά με χρήση αντικειμένων.

[pass_by_assignment.py](./../../pl/python/pass_by_assignment.py)

### 9.5.5 Έλεγχος τύπων παραμέτρων

Στην C (από την έκδοση C99 και μετά), C++, Java και C# γίνεται έλεγχος τύπων παραμέτρων. Στην Python και στην Ruby δεν γίνεται έλεγχος τύπων παραμέτρων.

### 9.5.6 Διατάξεις πολλαπλών διαστάσεων ως παράμετροι

Οι διατάξεις δύο διαστάσεων στη C είναι διατάξεις διατάξεων και αποθηκεύονται κατά γραμμές στη μνήμη.

Όταν ένας πίνακας μεταβιβάζεται ως παράμετρος, η τυπική παράμετρος θα πρέπει να περιλαμβάνει το πλήθος των στηλών στο δεύτερο ζεύγος αγκυλών.

<!-- ## 9.6 Παράμετροι που είναι υποπρογράμματα

## 9.7 Έμμεση κλήση υποπρογραμμάτων

## 9.8 Ζητήματα σχεδιασμού για συναρτήσεις

## 9.9. Υπερφορτωμένα υποπρογράμματα -->

## 9.10 Γενικά υποπρογράμματα

### 9.10.1 Γενικές συναρτήσεις στη C++

Οι γενικές συναρτήσεις στη C++ ονομάζονται πρότυπες συναρτήσεις.

* [template1.cpp](./../../pl/cpp/template1.cpp)

<!-- ### 9.10.2 Γενικές συναρτήσεις στη Java

## 9.11 Υπερφορτωμένοι τελεστές που ορίζει ο χρήστης

## 9.12 Κλειστότητα

## 9.13 Συρρουτίνες -->
