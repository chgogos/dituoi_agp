# 15. Γλώσσες συναρτησιακού προγραμματισμού

* Οι γλώσσες συναρτησιακού προγραμματισμού στηρίζονται σε βασικές ιδέες των μαθηματικών συναρτήσεων.
* Γλώσσες συναρτησιακού προγραμματισμού: Lisp, Scheme, Racket, ML, OCaml, Haskell, F#.
* Υποστήριξη για συναρτησιακό προγραμματισμό από προστακτικές γλώσσες.
* Εφαρμογές γλωσσών συναρτησιακού προγραμματισμού.

## 15.1 Εισαγωγή

Το προστακτικό στυλ προγραμματισμού παρουσιάζει μεγάλη εξάρτηση από την επικρατούσα αρχιτεκτονική των Η/Υ.

Τα προγράμματα που γράφονται σε προστακτικές γλώσσες διατηρούν μια κατάσταση (οι τιμές των μεταβλητών του προγράμματος) η οποία αλλάζει καθώς εκτελείται το πρόγραμμα. Ο προγραμματιστής πρέπει να κατανοεί το πως μεταβάλλεται η κατάσταση του προγράμματος κατά την εκτέλεση, κάτι το οποίο δεν είναι καθόλου εύκολο για μεγάλα προγράμματα.

Τα προγράμματα σε συναρτησιακές γλώσσες δεν έχουν μεταβλητές και δεν υπάρχει η έννοια της κατάστασης του προγράμματος όπως στα προγράμματα των προστακτικών γλωσσών.

## 15.2 Μαθηματικές συναρτήσεις

Μια μαθηματική συνάρτηση είναι μια αντιστοίχιση των μελών ενός συνόλου (του πεδίου ορισμού) σε ένα άλλο σύνολο (το πεδίο τιμών).

Σε μια μαθηματική συνάρτηση η σειρά αποτίμησης των εκφράσεων αντιστοίχισης προσδιορίζεται από εκφράσεις αναδρομής και συνθήκης και όχι από επαναληπτική εκτέλεση εντολών όπως συνηθίζεται στις προστακτικές γλώσσες.

Οι μαθηματικές συναρτήσεις δεν έχουν παράπλευρες συνέπειες (side-effects).

### 15.2.1 Απλές συναρτήσεις


Ο συμβολισμός εκφράσεων λάμδα διατυπώθηκε από τον A. Church το 1941 και αποτελεί έναν τρόπο ορισμού συναρτήσεων χωρίς ονόματα. Μια έκφραση λάμδα καθορίζει τις παραμέτρους και την αντιστοίχιση μιας συνάρτησης. Ο Church όρισε τον **λογισμό λάμδα** που αποτελεί ένα επίσημο μοντέλο υπολογισμών που χρησιμοποιεί εκφράσεις λάμδα. Η συναρτησιακές γλώσσες προγραμματισμού βασίζονται στον λογισμό λάμδα.

```
λ(x) x*x*x
```

Πριν την αποτίμησή της μια παράμετρος αναπαριστά οποιοδήποτε μέλος του πεδίου ορισμού, αλλά κατά τη διάρκεια της αποτίμησης δεσμεύεται σε ένα συγκεκριμένο μέλος του πεδίου ορισμού.

```
(λ(x) x*x*x)(2)
```

### 15.2.2 Συναρτησιακές μορφές

Μια συναρτησιακή μορφή ή συνάρτηση υψηλής τάξης (high-order function) είναι μια συνάρτηση που παίρνει μια ή περισσότερες συναρτήσεις ως παραμέτρους, ή επιστρέφει μια συνάρτηση ως αποτέλεσμα ή και τα δύο.

Παραδείγματα συναρτησιακών μορφών

* Σύνθεση συναρτήσεων (composition)
* Εφαρμογή σε όλα (apply-to-all)

## 15.3 Βασικά στοιχεία των γλωσσών συναρτησιακού προγραμματισμού

Μια αμιγής συναρτησιακή γλώσσα δεν έχει μεταβλητές και προτάσεις εκχώρησης όπως οι προστακτικές γλώσσες. Συνεπώς, δεν υποστηρίζει δομές επανάληψης καθώς ο έλεγχός τους θα χρειαζόταν μεταβλητές. Η δε επανάληψη επιτυγχάνεται μέσω αναδρομής. 

Η εκτέλεση μιας συνάρτησης με τις ίδιες παραμέτρους παράγει το ίδιο αποτέλεσμα (αναφορική διαφάνεια = referential transparency). Συνεπώς ο έλεγχος της ορθότητας συναρτήσεων μπορεί να γίνεται χωριστά για κάθε συνάρτηση.

Μια συναρτησιακή γλώσσα παρέχει ένα σύνολο από βασικές συναρτήσεις, ένα σύνολο από συναρτησιακές μορφές για σύνθεση συναρτήσεων, μια πράξη εφαρμογής συναρτήσεων και κάποιες δομές για την αναπαράσταση παραμέτρων και  αποτελεσμάτων των συναρτήσεων.

## 15.4 Η πρώτη συναρτησιακή γλώσσα προγραμματισμού: Lisp

John McCarthy 1959

Οι σύγχρονες διάλεκτοι της Lisp περιλαμβάνουν χαρακτηριστικά προστακτικών γλωσσών, όπως μεταβλητές προστακτικού τύπου, προτάσεις εκχώρησης και επανάληψη. 

### 15.4.1 Τύποι και δομές δεδομένων

Δύο βασικές κατηγορίες αντικειμένων δεδομένων στη Lisp είναι τα άτομα και οι λίστες.

* Τα άτομα είναι είτε σύμβολα είτε αριθμητικές τιμές.
* Οι λίστες οριοθετούν τα στοιχεία τους με παρενθέσεις, ενώ ένα στοιχείο μιας λίστας μπορεί να είναι το ίδιο λίστα. Η λίστες συνήθως υλοποιούνται ως συνδεδεμένες λίστες και κάθε κόμβος έχει δύο δύο δείκτες, έναν για αναφορές στα δεδομένα του κόμβου και ένα που δείχνει προς το επόμενο στοιχείο της λίστας ή για το τελευταίο στοιχείο της λίστας στην τιμή nil.

Παραδείγματα λιστών

```
(A B C D)

(A (B C) D (E (F G)))
```

### 15.4.2 Ο πρώτος διερμηνευτής της Lisp

Η κλήση συνάρτησης γίνεται ως εξής:

```
(όνομα_συνάρτησης παράμετρος1 παράμετρος2 ... παράμετροςn)
```

S-εκφράσεις

EVAL: καθολική συνάρτηση αποτίμησης όλων των συναρτήσεων. Τα προγράμματα ερμηνεύονται από την καθολική συνάρτηση EVAL.

## 15.5 Scheme


### 15.5.1 Η προέλευση της Scheme

Η γλώσσα Scheme είναι διάλεκτος της Lisp. Είναι μια μικρή γλώσσα, χωρίς τύπους, με απλό συντακτικό και σημασιολογία.

### 15.5.2 Ο διερμηνευτής της Scheme

H Scheme διαθέτει REPL (Read Evaluate Print Loop).

### 15.5.3 Βασικές αριθμητικές συναρτήσεις

### 15.5.4 Ορισμός συναρτήσεων

Ένα πρόγραμμα Scheme είναι μια συλλογή από ορισμούς συναρτήσεων. 

Μια ανώνυμη συνάρτηση περιλαμβάνει τη λέξη lambda και ονομάζεται έκφραση lambda.

### 15.5.5 Συναρτήσεις εξόδου

### 15.5.6 Αριθμητικές συναρτήσεις κατηγορημάτων

Μια κατηγορηματική συνάρτηση είναι μια συνάρτηση που επιστρέφει μια λογική τιμή. Οι προκαθορισμένες κατηγορηματικές συναρτήσεις έχουν ονόματα που τελειώνουν με αγγλικό ερωτηματικό.

### 15.5.7 Ροή ελέγχου

```
(if predicate then_expression else_expression)
```

```
(cond cond-clause ...)
cond-clause	 	=	 	[test-expr then-body ...+]
 	 	|	 	[else then-body ...+]
 	 	|	 	[test-expr => proc-expr]
 	 	|	 	[test-expr]
```

### 15.5.8 Συναρτήσεις λιστών

Τα δεδομένα και ο κώδικας έχουν την ίδια μορφή. 

**Συνάρτηση QUOTE**

Επιστρέφει την παράμετρο χωρίς μεταβολή.

**Συνάρτηση CAR**

Επιστρέφει την κεφαλή της λίστας.

**Συνάρτηση CDR** 

Επιστρέφει την ουρά της λίστας.

**Συνάρτηση CONS** 

Κατασκευάζει μια νέα λίστα από δύο ξεχωριστά τμήματα λίστας.

**Συνάρτηση LIST**

Κατασκευάζει μια λίστα από μεταβλητό αριθμό παραμέτρων.

### 15.5.9 Συναρτήσεις κατηγορημάτων για συμβολικά άτομα και λίστες

Διατίθενται 3 βασικές συναρτήσεις κατηγορημάτων για συμβολικά άτομα και λίστες.
* EQ?  πραγματοποιεί σύγκριση δεικτών
* EQV? πραγματοποιεί σύγκριση τιμών
* NULL? επιστρέφει #Τ αν το όρισμά της είναι κενό
* LIST? επιστρέφει #Τ αν το όρισμά της είναι λίστα

To EQ? λειτουργεί σωστά για συμβολικά άτομα αλλά όχι απαραίτητα για αριθμητικά άτομα. Για τα αριθμητικά άτομα μπορεί να χρησιμοποιηθεί το κατηγόρημα =. 

## 15.6 Common Lisp

## 15.7 ML

## 15.8 Haskell

## 15.9 F#

## 15.10 Υποστήριξη συναρτησιακού προγραμματισμού σε κυρίως προστακτικές γλώσσες

Στοιχεία συναρτησιακού προγραμματισμού έχουν προστεθεί σε γλώσσες κυρίως προστακτικού προγραμματισμού. Ένα παράδειγμα είναι οι ανώνυμες συναρτήσεις που μοιάζουν με εκφράσεις λάμδα και συναντώνται στις C++, Java, Python, C#, JavaScript, Ruby.

**JavaScript**

**Java**

**Python**

```python
lambda a,b: 2 * a - b
```

H Python έχει τις συναρτήσεις υψηλής τάξης filter και map που χρησιμοποιούν ως πρώτη παράμετρο εκφράσεις λάμδα, ως δεύτερη παράμετρο έναν τύπο ακολουθίας (λίστα, πλειάδα ή συμβολοσειρά) και επιστρέφουν τον ίδιο τύπο ακολουθίας.

```python
map(lambda x: x**3, [2,4,6,8])
```

θα επιστρέψει

```
[8, 64, 216, 512]
```

Επιπλέον, η Python υποστηρίζει εφαρμογές μερικών συναρτήσεων (partial functions).

```python
from operator import add
add5 = partial(add,5)
print(add5(15))
```

θα εμφανίσει την τιμή 20.

**C++**


## 15.11 Σύγκριση συναρτησιακών και προστακτικών γλωσσών

* Οι συναρτησιακές γλώσσες μπορούν να έχουν πιο απλή συντακτική δομή και απλούστερη σημασιολογία.
* Τα συναρτησιακά προγράμματα δεν έχουν παράπλευρες συνέπειες (side effects).
* Τα συναρτησιακά προγράμματα έχουν μικρότερο μέγεθος σε σχέση με τα αντίστοιχα προστακτικά προγράμματα.
* Τα προτασιακά προγράμματα είναι ταχύτερα από τα αντίστοιχα συναρτησιακά προγράμματα.
* Οι συναρτησιακές γλώσσες διευκολύνουν την ανάγνωση του κώδικα.
* Η ταυτόχρονη εκτέλεση στις προστακτικές γλώσσες παρουσιάζει διάφορες δυσκολίες. Λόγω της απουσίας παράπλευρων συνεπειών στον αμιγή συναρτησιακό προγραμματισμό καθίσταται ευκολότερη η ταυτόχρονη εκτέλεση συναρτήσεων.  
* Η πλειοψηφία των προγραμματιστών μαθαίνουν προγραμματισμό σε προστακτικές γλώσσες και κατά συνέπεια τα συναρτησιακά προγράμματα φαίνονται περίεργα και δυσνόητα.